(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{13264:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return M}});var n=r(24246),a=r(57135),s=r.n(a),o=r(27791),c=r(22951),i=r(91976),l=r(47169),d=r(31753),u=r(20066),h=r(27597),f=r(64649),p=r(27378),w=r(72371),m=r(15606),x=r(87137),v=r(27949),j=r(25773),g=function(e){var t=(0,j.Z)({},e),r=new Date(1e3*t.from),a=t.to?new Date(1e3*t.to):void 0,s=r.toLocaleDateString()+" "+r.toLocaleTimeString(),o=a?a.toLocaleDateString()+" "+a.toLocaleTimeString():"",c=t.reward,i=t.totalStaked,l=Math.round(1e5*c/(t.to-t.from))/1e5;return(0,n.jsxs)("tr",{children:[(0,n.jsxs)("td",{style:{textAlign:"center"},children:[" ",t.id,"  "]}),(0,n.jsxs)("td",{style:{textAlign:"center"},children:[" ",s," "]}),(0,n.jsxs)("td",{style:{textAlign:"center"},children:[" ",o," "]}),(0,n.jsxs)("td",{style:{textAlign:"right"},children:[" ",c," FFOOD"]}),(0,n.jsxs)("td",{style:{textAlign:"right"},children:[" ",l," FFOOD/s "]}),(0,n.jsxs)("td",{style:{textAlign:"right"},children:[" ",i," FFOOD "]})]},t.id)},Z=r(67327),y=r(19087),D=r(52125),A=r(23907),P=r(75124),R=r(22648),S=r.n(R),C=r(84746);r(47846);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,h.Z)(e);if(t){var a=(0,h.Z)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var k=function(e){(0,d.Z)(r,e);var t=b(r);function r(e){var n;(0,c.Z)(this,r),n=t.call(this,e),(0,f.Z)((0,l.Z)(n),"updateAmount",(function(e){var t=parseInt(e.target.value),r=!isNaN(t)&&t>0;n.setState({validAmount:r,amount:e.target.value}),r&&n.checkAllowance(t).then((function(e){n.setState({sufficientAllowance:e})}))})),(0,f.Z)((0,l.Z)(n),"updateDate",(function(e,t){var r={};r[e]=t,n.setState(r)})),(0,f.Z)((0,l.Z)(n),"allowButtonPressed",(0,o.Z)(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=parseInt(n.state.amount),e.next=3,(0,C.dE)(t);case 3:n.checkAllowance(t).then((function(e){n.setState({sufficientAllowance:e})})),n.props.allowanceUpdated();case 5:case"end":return e.stop()}}),e)})))),(0,f.Z)((0,l.Z)(n),"checkAllowance",(function(e){return new Promise((function(t,r){(0,C.RC)().then((function(r,n){var a=parseInt(e)<=r;t(a)})).catch((function(e){console.error("Error checking allowance",e),r(e)}))}))})),(0,f.Z)((0,l.Z)(n),"submitForm",(function(){var e=n.state,t=e.amount,r=e.startDate,a=e.endDate,s=e.sufficientAllowance,o=e.validAmount;if(s)if(o){var c=parseInt(t);(0,y.Kb)(c,r,a).then((function(e){n.props.handleSuccess("New reward phase created. Transaction id: ".concat(e.tx))})).catch((function(e){console.log("Error 2 createRewardPhase:",e);var t=n.getRewardPeriodError(e);n.props.handleError(e,t)}))}else n.setState({error:"Invalid tolen amount"});else n.setState({error:"Insufficient token allowance"})})),(0,f.Z)((0,l.Z)(n),"getRewardPeriodError",(function(e){switch(!0){case e.message.includes("Invalid period start time"):return"Invalid period start time";case e.message.includes("Invalid reward amount"):return"Invalid reward amount";case e.message.includes("Invalid reward interval"):return"Invalid reward interval";default:return e.message}}));var a=e.startDate&&new Date(1e3*(e.startDate+1))||new Date,i=new Date(a.getTime()+6048e5);return n.state={sufficientAllowance:!1,validAmount:!1,startDate:a,endDate:i,amount:""},n}return(0,i.Z)(r,[{key:"render",value:function(){var e=this;return(0,n.jsxs)("div",{className:"p-2",children:[(0,n.jsx)("h3",{children:"New Reward Phase"}),(0,n.jsxs)(A.Z,{children:[(0,n.jsxs)(A.Z.Group,{className:"mb-3",controlId:"startDate",children:[(0,n.jsx)(A.Z.Label,{children:"Start Date"}),(0,n.jsx)(S(),{name:"startDate",className:"form-control datepicker",autoComplete:"off",onChange:function(t){return e.updateDate("startDate",t)},dateFormat:"yyyy-MM-dd",selected:this.state.startDate&&new Date(this.state.startDate)||null}),(0,n.jsx)(A.Z.Text,{className:"text-muted",children:"The date the reward phase start"})]}),(0,n.jsxs)(A.Z.Group,{className:"mb-3",controlId:"endDate",children:[(0,n.jsx)(A.Z.Label,{children:"End Date"}),(0,n.jsx)(S(),{name:"endDate",className:"form-control datepicker",autoComplete:"off",onChange:function(t){return e.updateDate("endDate",t)},dateFormat:"yyyy-MM-dd",selected:this.state.endDate&&new Date(this.state.endDate)||null}),(0,n.jsx)(A.Z.Text,{className:"text-muted",children:"The date the reward phase end"})]}),(0,n.jsxs)(A.Z.Group,{className:"mb-3",controlId:"rewardAmountt",children:[(0,n.jsx)(A.Z.Label,{children:"Amount"}),(0,n.jsxs)(P.Z,{className:"mb-3",children:[(0,n.jsx)(A.Z.Control,{style:{maxWidth:200},type:"text",placeholder:"0.0",autoComplete:"off",title:"Amount",onChange:function(t){return e.updateAmount(t)}}),(0,n.jsx)(P.Z.Text,{children:" ETB "})]})]}),(0,n.jsxs)("div",{style:{textAlign:"center"},className:"pt-2",children:[this.state.validAmount&&!this.state.sufficientAllowance&&(0,n.jsx)(x.Z,{name:"allow",type:"button",variant:"outline-primary",onClick:function(t){return e.allowButtonPressed()},className:"pl-2",children:"Allow ETB token transfer"}),"\xa0\xa0\xa0",(0,n.jsx)(x.Z,{variant:"outline-primary",onClick:this.submitForm,disabled:!(this.state.validAmount&&this.state.sufficientAllowance),children:"Submit"})]})]})]})}}]),r}(p.Component),O=r(82990);function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,h.Z)(e);if(t){var a=(0,h.Z)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var M=function(e){(0,d.Z)(r,e);var t=N(r);function r(e){var n;return(0,c.Z)(this,r),n=t.call(this,e),(0,f.Z)((0,l.Z)(n),"headerRef",p.createRef()),(0,f.Z)((0,l.Z)(n),"setAccountConnected",(function(e){n.setState({accountConnected:e})})),(0,f.Z)((0,l.Z)(n),"toggleCreateRewardPhaseModal",(0,o.Z)(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.state.showCreateRewardPhaseModal,n.setState({showCreateRewardPhaseModal:!t});case 2:case"end":return e.stop()}}),e)})))),(0,f.Z)((0,l.Z)(n),"handleSuccess",(function(e){console.log(">>> handleSubmit done! values: ",e,"this.headerRef.",n.headerRef.current.reload),n.headerRef.current.reload(),n.reload(),n.setState({info:{title:"Success!",detail:e}})})),(0,f.Z)((0,l.Z)(n),"handleError",(function(e,t){console.log(">>> handleError",e,t),t?n.setState({error:t}):e.message?n.setState({error:e.message}):n.setState({error:"An error occurred (".concat(e.toString(),")")})})),n.state={showCreateRewardPhaseModal:!1,accountConnected:!1},n.headerRef=p.createRef(),n}return(0,i.Z)(r,[{key:"componentDidMount",value:function(){this.reload()}},{key:"reload",value:function(){console.log("reload AdminPage"),this.loadRewardPeriods()}},{key:"loadRewardPeriods",value:function(){var e=(0,o.Z)(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,y.GP)().then((function(e){t.setState({rewardPeriods:e.reverse()})})).catch((function(e){console.log(">>> error loading reward phases:",e),t.setState({error:e.message})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"handleAllowanceUpdated",value:function(){var e=(0,o.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(">>> handleAllowanceUpdated"),this.headerRef.current.reload();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,r=t.accountConnected,a=t.showCreateRewardPhaseModal,s=t.rewardPeriods;if(!r)return(0,n.jsxs)(Z.T3,{children:[(0,n.jsx)(v.Z,{ref:this.headerRef,reload:function(){return e.reload()},setAccountConnected:function(t){return e.setAccountConnected(t)}}),(0,n.jsx)(Z.M5,{children:(0,n.jsx)(w.Z,{variant:"info",title:"No Ethereum account connected",style:{textAlign:"center"},children:"Please connect an Ethereum account to access this dapp!"})})]});var o=s&&s.map((function(e,t){return(0,n.jsx)(g,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){(0,f.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e),e.id)})),c=this.state.rewardPeriods&&this.state.rewardPeriods.length>0&&this.state.rewardPeriods[0];return(0,n.jsxs)(Z.T3,{children:[(0,n.jsx)(v.Z,{ref:this.headerRef,reload:function(){return e.reload()},setAccountConnected:function(t){return e.setAccountConnected(t)}}),a&&(0,n.jsx)(O.Z,{onClose:this.toggleCreateRewardPhaseModal,children:(0,n.jsx)(k,{handleSuccess:function(t){return e.handleSuccess(t)},handleError:function(t,r){return e.handleError(t,r)},allowanceUpdated:function(){return e.handleAllowanceUpdated()},startDate:c&&c.to})}),(0,n.jsxs)(Z.M5,{children:[this.state.error&&(0,n.jsxs)(D.a,{variant:"danger",title:"Error",children:[" ",this.state.error," "]}),this.state.info&&(0,n.jsx)(D.a,{variant:"info",title:this.state.info.title,children:this.state.info.detail})]}),o&&0==o.length&&(0,n.jsx)(Z.M5,{className:"mt-2",children:(0,n.jsx)(w.Z,{variant:"info",children:" No reward phase configured"})}),o&&o.length>0&&(0,n.jsx)(Z.M5,{children:(0,n.jsxs)(m.Z,{responsive:!0,bordered:!0,striped:"on",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"#"}),(0,n.jsx)("th",{children:"Start Date"}),(0,n.jsx)("th",{children:"End Date"}),(0,n.jsx)("th",{children:"Total Reward"}),(0,n.jsx)("th",{children:"Reward / sec"}),(0,n.jsx)("th",{children:"Currently Staked"})]})}),(0,n.jsx)("tbody",{children:o})]})}),(0,n.jsx)("div",{style:{textAlign:"center"},children:(0,n.jsx)(x.Z,{onClick:this.toggleCreateRewardPhaseModal,children:"Create New Reward Phase"})})]})}}]),r}(p.Component)},87267:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return r(13264)}])}},function(e){e.O(0,[774,645,33,730,591,440,888,179],(function(){return t=87267,e(e.s=t);var t}));var t=e.O();_N_E=t}]);